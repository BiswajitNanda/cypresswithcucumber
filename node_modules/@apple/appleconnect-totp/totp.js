var otp = require('otpauth')
var fs = require('fs')

function Totp(secret_file, steps_since_epoch) {
  this.secret = this._read_from_file(secret_file)
  this.steps_since_epoch = steps_since_epoch
}

Totp.prototype.get_hotp = function() {
  var my_otp = new otp.TOTP({
    algorithm: 'SHA1',
    digits: 6,
    period: 30,
    secret: otp.Secret.fromB32(this.secret.toUpperCase())
  });

  return my_otp.generate();
}

Totp.prototype._read_from_file = function(filename) {
  var contents = fs.readFileSync(filename, 'utf8');
  return contents.replace(/(\n|\r)+$/, '')

}

module.exports = Totp

